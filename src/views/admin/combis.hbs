<div class="mx-3 container_tablas">
    <strong>
        <table class="table table-dark table-borderless" id="table" data-search="true" data-toggle="table"
            data-buttons="buttons" data-buttons-class="success" data-show-button-text="true" data-locale="es-AR"
            data-pagination="true">
            <thead>
                <tr>
                    <th data-field="id_combi">
                        ID
                    </th>
                    <th data-field="patente" data-sortable="true">
                        Patente
                    </th>
                    <th data-field="chofer" data-sortable="true">
                        Chofer asignado
                    </th>
                    <th data-field="cant_asientos" data-sortable="true">
                        Cantidad de asientos
                    </th>
                    <th data-field="tipo_asiento" data-sortable="true">
                        Tipo de asientos
                    </th>
                    <th data-field="id" data-formatter="LinkFormatterEdit"><i class="fas fa-user-edit"></i></th>
                    <th data-field="id" data-formatter="LinkFormatterDelete"><i class="fas fa-user-times"></i></th>
                </tr>
            </thead>
        </table>
</div>
</strong>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cancelar"></button>
            </div>
            <div class="modal-body">
                <form id="modalForm" href="/combis" method="POST">
                    <input type="number" id="recipient-id" name="id" hidden>
                    <div class="mb-3">
                        <label for="patente" class="form-label">Patente</label>
                        <input type="text" class="form-control" id="recipient-patente" name="patente">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="chofer">Seleccione un chofer</label>
                        <select class="form-select" id="recipient-chofer" name="chofer">
                            {{#each choferes}}
                                <option value={{id_usuario}}>{{name}} {{lastname}}</option>
                            {{/each}}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="cantAsientos" class="form-label">Cantidad de asientos</label>
                        <input type="number" class="form-control" id="recipient-cantAsientos" name="cantAsientos">
                    </div>
                    <div class="mb-3">
                        <label for="tipocama" class="form-label">Tipo de asientos</label>
                        <select name="tipoAsientos" id="recipient-tipoAsientos" class="form-select">
                            <option value="cama">Cama</option>
                            <option value="semi-cama">Semi-cama</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-success" id="guardarButton"></button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $table = $('#table');
        $('#table').bootstrapTable('load', []); //aca cuando se carga la pag , lo incializamos y luewgos por el get rellenamos la tabla 
        $.ajax({
            type: 'GET',
            url: 'http://localhost:3000/admin/combisJSON',
            data: {},
            dataType: 'json',
            success: function (data) {
                $('#table').bootstrapTable('load', data);
            }, error: function () {
                alert('Error conexion con el servidor');
            }
        });
    });
    $(function () {
        $('#exampleModal').on('shown.bs.modal', function (e) {
            $('#recipient-patente').focus();
        })
    });

    function LinkFormatterEdit(value, row) {
        console.log("aca: ", row.cant_asientos, row.tipo_asiento);
        return "<button type='button' class='btn btn-primary btn-xs edit_button'" +
            "data-toggle='modal' data-target='#exampleModal'" +
            "data-id='" + row.id_combi + "'" +
            "data-patente='" + row.patente + "'" +
            "data-chofer='" + row.chofer + "'" +
            "data-cantasientos='" + row.cant_asientos + "'" +
            "data-tipoasientos='" + row.tipo_asiento + "'>" +
            "Editar" +
            "</button>"
    }
    $(document).on("click", '.edit_button', function () {
        var patente = $(this).data('patente');
        var chofer = $(this).data('chofer');
        var cantAsientos = $(this).data('cantasientos');
        var tipoAsientos = $(this).data('tipoasientos');
        var id = $(this).data('id');


        $('#exampleModalLabel').text('Editar combi');
        $("#recipient-id").val(id);
        $("#recipient-patente").val(patente);
        $("#recipient-chofer").val(chofer);
        $("#recipient-cantAsientos").val(cantAsientos);
        $("#recipient-tipoAsientos").val(tipoAsientos);
        $('#exampleModal').modal('show')
        $('#guardarButton').text('Guardar');
        const patente2 = document.getElementById("recipient-patente").value;
        const chofer2 = document.getElementById("recipient-chofer").value;
        const cantAsientos2 = document.getElementById("recipient-cantAsientos").value;
        const tipoAsientos2 = document.getElementById("recipient-tipoAsientos").value;
        const personalButton = document.getElementById("guardarButton");

        const onChangeInputsPersonal = () => {
            let nombreBoolean = document.getElementById("recipient-patente").value == patente2;
            let choferBoolean = document.getElementById("recipient-chofer").value == chofer2;
            let cantAsientosBoolean = document.getElementById("recipient-cantAsientos").value == cantAsientos2;
            let tipoAsientosBoolean = document.getElementById("recipient-tipoAsientos").value == tipoAsientos2;
            (choferBoolean && cantAsientosBoolean && tipoAsientosBoolean && nombreBoolean) ? personalButton.disabled = true : personalButton.disabled = false;

            document.getElementById("recipient-patente").addEventListener('input', () => {
                onChangeInputsPersonal();
            });

            document.getElementById("recipient-chofer").addEventListener('input', () => {
                onChangeInputsPersonal();
            });

            document.getElementById("recipient-cantAsientos").addEventListener('input', () => {
                onChangeInputsPersonal();
            });
            document.getElementById("recipient-tipoAsientos").addEventListener('input', () => {
                onChangeInputsPersonal();
            });
            onChangeInputsPersonal();
        }
    });


    function LinkFormatterDelete(value) {
        return "<a href='/admin/combis/eliminar/" + value + "' ><button class='btn btn-danger'>Eliminar</button></a> ";
    }
    function buttons() {
        return {
            btnAdd: {
                text: 'Agregar combi',
                icon: 'fa fa-user-plus',
                event: {
                    click: () => {
                        $('#exampleModal').modal('show')
                        $('#modalForm').trigger("reset");
                        $('#guardarButton').text('Agregar');
                        $('#exampleModalLabel').text('Agregar una nueva combi');
                    }
                },
                attributes: {
                    title: 'Agregar una nueva combi',
                }
            }
        }
    }
</script>