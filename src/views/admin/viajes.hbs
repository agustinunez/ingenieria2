<div class="mx-3 container_tablas">
    <strong>
        <table class="table table-dark table-borderless" id="table" data-search="true" data-toggle="table"
            data-buttons="buttons" data-buttons-class="success" data-show-button-text="true" data-pagination="true"
            data-locale="es-AR">
            <thead>
                <tr class="">
                    <th data-field="id_viaje" data-sortable="true">
                        ID
                    </th>
                    <th data-field="ruta" data-sortable="true">
                        Ruta
                    </th>
                    <th data-field="fecha_salida" data-sortable="true">
                        Fecha de
                        <br>
                        salida
                    </th>
                    <th data-field="hora_salida" data-sortable="true">
                        Hora de
                        <br>
                        salida
                    </th>
                    <th data-field="fecha_llegada" data-sortable="true">
                        Fecha de
                        <br>
                        llegada
                    </th>
                    <th data-field="hora_llegada" data-sortable="true">
                        Hora de
                        <br>
                        llegada
                    </th>
                    <th data-field="combi" data-sortable="true">
                        Combi
                    </th>
                    <th data-field="asientos_asignados" data-sortable="true">
                        Asientos
                        <br>
                        asignados
                    </th>
                    <th data-field="asientos_disponibles" data-sortable="true">
                        Asientos
                        <br>
                        disponibles
                    </th>
                    <th data-field="fecha_publicacion" data-sortable="true">
                        Fecha de
                        <br>
                        publicacion
                    </th>
                    <th data-field="precio" data-sortable="true">
                        Precio
                    </th>
                    <th data-field="id_viaje" data-formatter="LinkFormatterInsumos">Insumos</th>
                    <th data-field="id_viaje" data-formatter="LinkFormatterEdit"><i class="fas fa-user-edit"></i></th>
                    <th data-field="id_viaje" data-formatter="LinkFormatterDelete"><i class="fas fa-user-times"></i>
                    </th>
                </tr>
            </thead>
        </table>
    </strong>
</div>


{{!-- ---------------------------------------------------------------------------------------------------EMPIEZA EL
MODAL------------------------------------------------------------------------------------- --}}
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cancelar"></button>
            </div>
            <div class="modal-body">
                <form id="modalForm" action="/admin/viajes" method="POST">
                    <input type="number" id="recipient-id" name="id" hidden>
                    <div class="mb-3">
                        <label for="recipient-ruta" class="form-label">Ruta:</label>
                        <select class="form-select" id="recipient-ruta" name="ruta">
                            {{#each rutas}}
                            <option value={{id_ruta}}>{{nombreorigen}} - {{nombredestino}}</option>
                            {{/each}}
                        </select>
                        <div class="invalid-feedback">
                            <p id="invalid-ruta"></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="recipient-fechasalida">Fecha de salida:</label>
                        <input type="date" class="form-control" id="recipient-fechasalida" name="fechasalida">
                        <div class="invalid-feedback">
                            <p id="invalid-fechasalida"></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="recipient-horasalida" class="form-label">Hora de salida:</label>
                        <input type="time" class="form-control" id="recipient-horasalida" name="horasalida">
                        <div class="invalid-feedback">
                            <p id="invalid-horasalida"></p>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="recipient-fechallegada">Fecha de llegada:</label>
                        <input type="date" class="form-control" id="recipient-fechallegada" name="fechallegada">
                        <div class="invalid-feedback">
                            <p id="invalid-fechallegada"></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="recipient-horallegada" class="form-label">Hora de llegada:</label>
                        <input type="time" class="form-control" id="recipient-horallegada" name="horallegada">
                        <div class="invalid-feedback">
                            <p id="invalid-horallegada"></p>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="recipient-combi" class="form-label">Combi:</label>
                        <select class="form-select" id="recipient-combi" name="combi">
                            {{#each combis}}
                            <option value={{id_combi}}>{{patente}}</option>
                            {{/each}}
                        </select>
                        <div class="invalid-feedback">
                            <p id="invalid-combi"></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="recipient-asientosAsignados" class="form-label">Asientos asignados:</label>
                        <input type="number" class="form-control" id="recipient-asientosAsignados" name="asientosAsignados">
                        <div class="invalid-feedback">
                            <p id="invalid-asientosAsignados"></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="recipient-fechapublicacion" class="form-label">Fecha de publicacion:</label>
                        <input type="date" class="form-control" id="recipient-fechapublicacion" name="fechapublicacion">
                        <div class="invalid-feedback">
                            <p id="invalid-fechapublicacion"></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        {{!-- Chequear que sea de tipo number o double --}}
                        <label for="recipient-precio" class="form-label">Precio:</label>
                        <input type="number" class="form-control" id="recipient-precio" name="precio"
                            autocomplete='off'>
                        <div class="invalid-feedback">
                            <p id="invalid-precio"></p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-success" id="guardarButton"></button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{{!-- ---------------------------------------------------------------------------------------------------TERMINA EL
MODAL------------------------------------------------------------------------------------- --}}

<div class="modal fade" id="insumosModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Insumos</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cancelar"></button>
            </div>
            <div class="modal-body">
                <form id="modalInsumoForm" action="/admin/viajes/insumos" method="POST">
                    <input type="number" id="id_insumoViaje" name="id_insumoViaje" hidden>
                    <div class="mb-3">
                        <label for="insumo" class="form-label">Insumo:</label>
                        <select class="form-select" id="insumo" name="insumo">
                            {{#each insumos}}
                                <option value={{id_insumo}}>{{nombre}}</option>
                            {{/each}}
                        </select>
                        <div class="invalid-feedback">
                            <p id="invalid-nombre"></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="cantidad" class="form-label">Cantidad:</label>
                        <input type="number" class="form-control" id="cantidad" name="cantidad" autocomplete='off'>
                        <div class="invalid-feedback">
                            <p id="invalid-cantidad"></p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="submit" class="btn btn-success" id="agregarInsumoBtn">Agregar</button>
                    </div>
                </form>
                <div class="mx-3 container_tablas">
                    <strong>
                        <table class="table table-dark table-borderless" id="tableInsumos" data-toggle="table" data-show-button-text="true" 
                            data-locale="es-AR">
                            <thead>
                                <tr class="">
                                    <th data-field="nombre" data-sortable="true">
                                        Insumo
                                    </th>
                                    <th data-field="cantidad" data-sortable="true">
                                        Cantidad
                                    </th>
                                    {{!-- <th data-field="id_viaje" data-formatter="LinkFormatterInsumos">Insumos</th>
                                    <th data-field="id_viaje" data-formatter="LinkFormatterEdit"><i class="fas fa-user-edit"></i></th> --}}
                                    <th data-field="id_viaje" data-formatter="InsumoFormatterDelete"><i class="fas fa-user-times"></i></th>
                                </tr>
                            </thead>
                        </table>
                    </strong>
                </div>
            </div>
        </div>
    </div>
</div>


<script>

    $(document).ready(function () {
        $('#table').bootstrapTable('load', []); //aca cuando se carga la pag , lo incializamos y luewgos por el get rellenamos la tabla 
        $.ajax({
            type: 'GET',
            url: 'http://localhost:3000/admin/viajesJSON',
            data: {},
            dataType: 'json',
            success: function (data) {
                $('#table').bootstrapTable('load', data);
            }, error: function () {
                alert('Error conexion con el servidor');
            }
        });
    });


    //---------------------------------------------------------------------------------------------------AUTOFOCUS-------------------------------------------------------------------------------------


    $('#recipient-ruta').focusout(function () {
        const rutaElement = $('#recipient-ruta');
        if (rutaElement.val() == null || rutaElement.val() == "") {
            $('#invalid-ruta').text('Este campo no puede estar vacio!');
            rutaElement.addClass('is-invalid');
        } else {
            rutaElement.removeClass('is-invalid');
            rutaElement.addClass('is-valid');
        };
    });

    $('#recipient-fechasalida').focusout(function () {
        const fechasalidaElement = $('#recipient-fechasalida');
        const idElement = $('#recipient-id');
        if (fechasalidaElement.val() == null || fechasalidaElement.val() == "") {
            $('#invalid-fechasalida').text('Este campo no puede estar vacio!');
            fechasalidaElement.addClass('is-invalid');
        } else {
            const fechasalidaValue = fechasalidaElement.val();
            const idValue = idElement.val();
            $.ajax('/admin/viajes/fechasalida', {
                type: 'POST',
                data: { fechasalidaValue, idValue },
                success: function (res) {
                    if (res) {
                        fechasalidaElement.removeClass('is-invalid');
                        fechasalidaElement.addClass('is-valid');
                    } else {
                        $('#invalid-fechasalida').text('Lo siento, la Fecha de salida debe ser mayor o igual a la fecha actual!');
                        fechasalidaElement.addClass('is-invalid');
                    }
                }
            });
        };

    });
    $('#recipient-horasalida').focusout(function () {
        const horasalidaElement = $('#recipient-horasalida');
        const idElement = $('#recipient-id');
        if (horasalidaElement.val() == null || horasalidaElement.val() == "") {
            $('#invalid-horasalida').text('Este campo no puede estar vacio!');
            horasalidaElement.addClass('is-invalid');
        } else {
            const fechasalidaValue = $('#recipient-fechasalida').val();
            const horasalidaValue = horasalidaElement.val();
            const idValue = idElement.val();
            horasalidaElement.removeClass('is-invalid');
            horasalidaElement.addClass('is-valid');
            $.ajax('/admin/viajes/horasalida', {
                type: 'POST',
                data: { horasalidaValue, fechasalidaValue, idValue },
                success: function (res) {
                    if (res) {
                        horasalidaElement.removeClass('is-invalid');
                        horasalidaElement.addClass('is-valid');
                    } else {
                        $('#invalid-horasalida').text('Lo siento, la Hora de salida debe ser mayor o igual a la hora actual!');
                        horasalidaElement.addClass('is-invalid');
                    }
                }
            });
        };
    });

    $('#recipient-fechallegada').focusout(function () {
        const fechallegadaElement = $('#recipient-fechallegada');
        const idElement = $('#recipient-id');
        if (fechallegadaElement.val() == null || fechallegadaElement.val() == "") {
            $('#invalid-fechallegada').text('Este campo no puede estar vacio!');
            fechallegadaElement.addClass('is-invalid');
        } else {
            const fechasalidaValue = $('#recipient-fechasalida').val();
            const fechallegadaValue = fechallegadaElement.val();
            const idValue = idElement.val();
            fechallegadaElement.removeClass('is-invalid');
            fechallegadaElement.addClass('is-valid');
            $.ajax('/admin/viajes/fechallegada', {
                type: 'POST',
                data: { fechasalidaValue, fechallegadaValue, idValue },
                success: function (res) {
                    if (res) {
                        fechallegadaElement.removeClass('is-invalid');
                        fechallegadaElement.addClass('is-valid');
                    } else {
                        $('#invalid-fechallegada').text('Lo siento, la Fecha de llegada debe ser mayor o igual a la Fecha de salida!');
                        fechallegadaElement.addClass('is-invalid');
                    }
                }
            });
        };
    });

    $('#recipient-horallegada').focusout(function () {
        const horallegadaElement = $('#recipient-horallegada');
        const idElement = $('#recipient-id');
        if (horallegadaElement.val() == null || horallegadaElement.val() == "") {
            $('#invalid-horallegada').text('Este campo no puede estar vacio!');
            horallegadaElement.addClass('is-invalid');
        } else {
            const fechasalidaValue = $('#recipient-fechasalida').val();
            const fechallegadaValue = $('#recipient-fechallegada').val();
            const horasalidaValue = $('#recipient-horasalida').val();
            const horallegadaValue = horallegadaElement.val();
            const idValue = idElement.val();
            horallegadaElement.removeClass('is-invalid');
            horallegadaElement.addClass('is-valid');
            $.ajax('/admin/viajes/horallegada', {
                type: 'POST',
                data: { fechasalidaValue, fechallegadaValue, horasalidaValue, horallegadaValue, idValue },
                success: function (res) {
                    if (res) {
                        horallegadaElement.removeClass('is-invalid');
                        horallegadaElement.addClass('is-valid');
                    } else {
                        $('#invalid-horallegada').text('Lo siento, la Hora de llegada debe ser mayor o igual a la Hora de salida!');
                        horallegadaElement.addClass('is-invalid');
                    }
                }
            });
        };
    });

    $('#recipient-combi').focusout(function () {
        const combiElement = $('#recipient-combi');
        console.log('combiElement', combiElement.val())
        if (combiElement.val() == null || combiElement.val() == "") {
            $('#invalid-combi').text('Este campo no puede estar vacio!');
            combiElement.addClass('is-invalid');
        } else {
            $('#invalid-combi').text('Este campo no puede estar vacio!');
            combiElement.removeClass('is-invalid');
            combiElement.addClass('is-valid');
        };
    });

    $('#recipient-asientosAsignados').focusout(function () {
        const asientosAsignadosElement = $('#recipient-asientosAsignados');
        if (asientosAsignadosElement.val() == null || asientosAsignadosElement.val() == "") {
            $('#invalid-asientosAsignados').text('Este campo no puede estar vacio!');
            asientosAsignadosElement.addClass('is-invalid');
        } else {
            const combiValue = $('#recipient-combi').val();
            asientosAsignadosElement.removeClass('is-invalid');
            asientosAsignadosElement.addClass('is-valid');
            if (combiValue != '') {
                const asientosValue = asientosAsignadosElement.val();
                const idValue = $('#recipient-id').val();
                $.ajax('/admin/viajes/asientos', {
                    type: 'POST',
                    data: { asientosValue, combiValue, idValue },
                    success: function (res) {
                        if (res.result) {
                            asientosAsignadosElement.removeClass('is-invalid');
                            asientosAsignadosElement.addClass('is-valid');
                        } else {
                            if (res.reason == 'combi') {
                                $('#invalid-asientosAsignados').text('Lo siento, la combi posee ['+res.value+'] asientos!');
                            } else {
                                $('#invalid-asientosAsignados').text('Lo siento, no puedes asignar menos asientos que los ya vendidos!');
                            }
                            asientosAsignadosElement.addClass('is-invalid');
                        }
                    }
                });
            }
        };
    });

    $('#recipient-fechapublicacion').focusout(function () {
        const fechapublicacionElement = $('#recipient-fechapublicacion');
        if (fechapublicacionElement.val() == null || fechapublicacionElement.val() == "") {
            $('#invalid-fechapublicacion').text('Este campo no puede estar vacio!');
            fechapublicacionElement.addClass('is-invalid');
        } else {
            const fechasalidaValue = $('#recipient-fechasalida').val();
            const fechapublicacionaValue = fechapublicacionElement.val();
            if (fechasalidaValue != '') {
                if (fechapublicacionaValue > fechasalidaValue){
                    $('#invalid-fechapublicacion').text('Lo siento, la Fecha de publicacion debe ser menor o igual a la Fecha de salida!');
                    fechapublicacionElement.addClass('is-invalid');
                }else{
                    fechapublicacionElement.removeClass('is-invalid');
                    fechapublicacionElement.addClass('is-valid');
                }
            }else{
                fechapublicacionElement.removeClass('is-invalid');
                fechapublicacionElement.addClass('is-valid');
            }
        }
    });
    $('#recipient-precio').focusout(function () {
        const precioElement = $('#recipient-precio');
        if (precioElement.val() == null || precioElement.val() == "") {
            $('#invalid-precio').text('Este campo no puede estar vacio!');
            precioElement.addClass('is-invalid');
        } else {
            precioElement.removeClass('is-invalid');
            precioElement.addClass('is-valid');
        };
    });

    $('#insumo').focusout(function () {
        const nombreElement = $('#insumo');
        if (nombreElement.val() == null || nombreElement.val() == "") {
            $('#invalid-nombre').text('Este campo no puede estar vacio!');
            nombreElement.addClass('is-invalid');
        } else {
            nombreElement.removeClass('is-invalid');
            nombreElement.addClass('is-valid');
        };
    });


    $('#cantidad').focusout(function () {
        const cantidadElement = $('#cantidad');
        if (cantidadElement.val() == null || cantidadElement.val() == "") {
            $('#invalid-cantidad').text('Este campo no puede estar vacio!');
            cantidadElement.addClass('is-invalid');
        } else {
            if (cantidadElement.val() < 1){
                $('#invalid-cantidad').text("Lo siento, la Cantidad debe ser mayor a 0!");
                cantidadElement.addClass('is-invalid');
                cantidadElement.removeClass('is-valid');
            }else{
                cantidadElement.removeClass('is-invalid');
                cantidadElement.addClass('is-valid');
            }
        };
    });

    //---------------------------------------------------------------------------------------------------FIN AUTOFOCUS-------------------------------------------------------------------------------------




    //---------------------------------------------------------------------------------------------------BOTON EDITAR-------------------------------------------------------------------------------------
    function LinkFormatterEdit(value, row) {
        return "<button type='button' class='btn btn-primary btn-xs edit_button'" +
            "data-toggle='modal' data-target='#exampleModal'" +
            "data-id='" + row.id_viaje + "'" +
            "data-ruta='" + row.ruta + "'" +
            "data-fechasalida='" + row.fecha_salida + "'" +
            "data-horasalida='" + row.hora_salida + "'" +
            "data-fechallegada='" + row.fecha_llegada + "'" +
            "data-horallegada='" + row.hora_llegada + "'" +
            "data-asientosasignados='" + row.asientos_asignados + "'" +
            "data-combi='" + row.combi + "'" +
            "data-fechapublicacion='" + row.fecha_publicacion + "'" +
            "data-precio='" + row.precio + "'>" +
            "Editar" +
            "</button>"
    }
    $(document).on("click", '.edit_button', function () {
        var id = $(this).data('id');
        var fecha_salida = $(this).data('fechasalida');
        var hora_salida = $(this).data('horasalida');
        var fecha_llegada = $(this).data('fechallegada');
        var hora_llegada = $(this).data('horallegada');
        var asientos_asignados = $(this).data('asientosasignados');
        var fecha_publicacion = $(this).data('fechapublicacion');
        var precio = $(this).data('precio');

        $.ajax('/admin/viajes/ruta', {
            type: 'POST',
            data: { id },
            success: function (res) {
                if (res.result) {
                    console.log('ASD');
                    $("#recipient-ruta").val(res.value);
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Lo siento, ha ocurrido un error!'
                    })
                }
            }
        });
        $.ajax('/admin/viajes/combi', {
            type: 'POST',
            data: { id },
            success: function (res) {
                if (res.result) {
                    $("#recipient-combi").val(res.value);
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Lo siento, ha ocurrido un error!'
                    })
                }
            }
        });
        $('#exampleModalLabel').text('Editar combi');
        $("#recipient-id").val(id);
        $("#recipient-fechasalida").val(fecha_salida);
        $("#recipient-horasalida").val(hora_salida);
        $("#recipient-fechallegada").val(fecha_llegada)
        $("#recipient-horallegada").val(hora_llegada);
        console.log('ASIENTOS ASIGNADOS: ', asientos_asignados);
        $("#recipient-asientosAsignados").val(asientos_asignados);
        $("#recipient-fechapublicacion").val(fecha_publicacion);
        $("#recipient-precio").val(precio);

        $("#recipient-ruta").removeClass("is-invalid is-valid");
        $("#recipient-fechasalida").removeClass("is-invalid is-valid");
        $("#recipient-horasalida").removeClass("is-invalid is-valid");
        $("#recipient-combi").removeClass("is-invalid is-valid");
        $("#recipient-fechapublicacion").removeClass("is-invalid is-valid");
        $("#recipient-precio").removeClass("is-invalid is-valid");

        $('#exampleModal').modal('show')
        $('#guardarButton').text('Guardar');

        const ruta2 = document.getElementById("recipient-ruta").value;
        const fechasalida2 = document.getElementById("recipient-fechasalida").value;
        const horasalida2 = document.getElementById("recipient-horasalida").value;
        const combi2 = document.getElementById("recipient-combi").value;
        const fechapublicacion2 = document.getElementById("recipient-fechapublicacion").value;
        const precio2 = document.getElementById("recipient-precio").value;
        const personalButton = document.getElementById("guardarButton");

        // console.log('TrueOrFalse',document.getElementById("recipient-combi").value == combi2);
        // console.log('Combi2',document.getElementById("recipient-combi").value);

        const onChangeInputsPersonal = () => {
            let rutaBoolean = document.getElementById("recipient-ruta").value == ruta2;
            let fechasalidaBoolean = document.getElementById("recipient-fechasalida").value == fechasalida2;
            let horasalidaBoolean = document.getElementById("recipient-horasalida").value == horasalida2;
            let combiBoolean = document.getElementById("recipient-combi").value == combi2;
            let fechapublicacionBoolean = document.getElementById("recipient-fechapublicacion").value == fechapublicacion2;
            let precioBoolean = document.getElementById("recipient-precio").value == precio2;

            (rutaBoolean && fechasalidaBoolean && horasalidaBoolean && combiBoolean && fechapublicacionBoolean && precioBoolean) ? personalButton.disabled = true : personalButton.disabled = false;

            document.getElementById("recipient-ruta").addEventListener('input', () => {
                onChangeInputsPersonal();
            });

            document.getElementById("recipient-fechasalida").addEventListener('input', () => {
                onChangeInputsPersonal();
            });

            document.getElementById("recipient-horasalida").addEventListener('input', () => {
                onChangeInputsPersonal();
            });
            document.getElementById("recipient-combi").addEventListener('input', () => {
                onChangeInputsPersonal();
            });
            document.getElementById("recipient-fechapublicacion").addEventListener('input', () => {
                onChangeInputsPersonal();
            });
            document.getElementById("recipient-precio").addEventListener('input', () => {
                onChangeInputsPersonal();
            });

            onChangeInputsPersonal();
        }
    });
    //---------------------------------------------------------------------------------------------------TERMINA EL BOTON EDITAR-------------------------------------------------------------------------------------





    //---------------------------------------------------------------------------------------------------BOTON ELIMINAR-------------------------------------------------------------------------------------   
    function LinkFormatterDelete(value) {
        return "<a onclick='confirmar(" + value + ")' ><button class='btn btn-danger'>Eliminar</button></a> ";
    }

    function InsumoFormatterDelete(value) {
        return "<a onclick='confirmarInsumo(" + value + ")' ><button class='btn btn-danger'><i class='fas fa-trash'></i></button></a> ";
    }
    //---------------------------------------------------------------------------------------------------TERMINO EL BOTON ELIMINAR--------------------------------------------------------------------------------

    //---------------------------------------------------------------------------------------------------BOTON AGREGAR-------------------------------------------------------------------------------------
    function buttons() {
        return {
            btnAdd: {
                text: 'Agregar viaje',
                icon: 'fa fa-user-plus',
                event: {
                    click: () => {
                        $('#exampleModalLabel').text('Agregar un nuevo viaje');
                        $('#guardarButton').text('Agregar');
                        $('#exampleModal').modal('show');

                        $("#recipient-ruta").removeClass("is-invalid is-valid");
                        $("#recipient-fechasalida").removeClass("is-invalid is-valid");
                        $("#recipient-horasalida").removeClass("is-invalid is-valid");
                        $("#recipient-fechallegada").removeClass("is-invalid is-valid");
                        $("#recipient-horallegada").removeClass("is-invalid is-valid");
                        $("#recipient-combi").removeClass("is-invalid is-valid");
                        $("#recipient-asientosAsignados").removeClass("is-invalid is-valid");
                        $("#recipient-fechapublicacion").removeClass("is-invalid is-valid");
                        $("#recipient-precio").removeClass("is-invalid is-valid");
                        $('#modalForm').trigger("reset");
                        $('#guardarButton').prop('disabled', false);
                    }
                },
                attributes: {
                    title: 'Agregar un nuevo viaje',
                }
            }
        }
    }
    //---------------------------------------------------------------------------------------------------TERMINO EL BOTON AGREGAR-------------------------------------------------------------------------------------



    function LinkFormatterInsumos(value) {
        return "<a onclick='mostrarInsumos(" + value + ")' ><button class='btn btn-warning'>Insumos</button></a> ";
    }


    //--------------------------------------------------------------------------------------------------- BOTON SUBMIT------------------------------------------------------------------------------------------------
    
    $("#modalInsumoForm").submit(function (e) {

        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var array = form.serializeArray();
        var id = array[0].value;
        $.ajax({
            type: "POST",
            url: url,
            data: form.serialize(),
            success: function (data) {
                if (data.length > 0) {
                    $('#insumo').addClass('is-valid');
                    $('#cantidad').addClass('is-valid');
                    $.each(data, function (index, value) {
                        if (value.param == 'insumo') {
                            $('#insumo').addClass('is-invalid');
                            $('#invalid-nombre').text(value.msg);
                        }
                        if (value.param == 'cantidad') {
                            $('#cantidad').addClass('is-invalid');
                            $('#invalid-cantidad').text(value.msg);
                        }
                    });
                } else {
                    Swal.fire(
                        'Agregado!',
                        'Se agrego el insumo al viaje exitosamente!',
                        'success'
                    )
                    $('#tableInsumos').bootstrapTable('load', []);
                    $.ajax({
                        type: 'GET',
                        url: 'http://localhost:3000/admin/insumosViajeJSON/'+id,
                        data: {},
                        dataType: 'json',
                        success: function (data) {
                            $('#tableInsumos').bootstrapTable('load', data);
                        }, error: function () {
                            alert('Error conexion con el servidor');
                        }
                    });
                    $("#nombre").removeClass("is-invalid is-valid");
                    $("#cantidad").removeClass("is-invalid is-valid");
                    $('#cantidad').val("");
                    document.getElementById("insumo").selectedIndex = "0";
                }
            }
        })
    });
    
    $("#modalForm").submit(function (e) {

        e.preventDefault(); // avoid to execute the actual submit of the form.

        var form = $(this);
        var url = form.attr('action');
        var array = form.serializeArray();
        var edit = array[0].value != '';
        $.ajax({
            type: "POST",
            url: url,
            data: form.serialize(), // serializes the form's elements.
            success: function (data) {
                if (data.length > 0) {
                    $('#recipient-fechasalida').removeClass('is-invalid');
                    $('#recipient-horasalida').removeClass('is-invalid');
                    $('#recipient-fechallegada').removeClass('is-invalid');
                    $('#recipient-horallegada').removeClass('is-invalid');
                    $('#recipient-combi').removeClass('is-invalid');
                    $('#recipient-asientosAsignados').removeClass('is-invalid');
                    $('#recipient-fechapublicacion').removeClass('is-invalid');
                    $('#recipient-precio').removeClass('is-invalid');

                    $('#recipient-ruta').addClass('is-valid');
                    $('#recipient-fechasalida').addClass('is-valid');
                    $('#recipient-horasalida').addClass('is-valid');
                    $('#recipient-fechallegada').addClass('is-valid');
                    $('#recipient-horallegada').addClass('is-valid');
                    $('#recipient-combi').addClass('is-valid');
                    $('#recipient-asientosAsignados').addClass('is-valid');
                    $('#recipient-fechapublicacion').addClass('is-valid');
                    $('#recipient-precio').addClass('is-valid');
                    console.log('DATA: ', data);
                    $.each(data, function (index, value) {
                        if (value.param == 'ruta') {
                            $('#recipient-ruta').addClass('is-invalid');
                            $('#invalid-ruta').text(value.msg);
                        }
                        if (value.param == 'fechasalida') {
                            $('#recipient-fechasalida').addClass('is-invalid');
                            $('#invalid-fechasalida').text(value.msg);
                        }
                        if (value.param == 'horasalida') {
                            $('#recipient-horasalida').addClass('is-invalid');
                            $('#invalid-horasalida').text(value.msg);
                        }
                        if (value.param == 'fechallegada') {
                            $('#recipient-fechallegada').addClass('is-invalid');
                            $('#invalid-fechallegada').text(value.msg);
                        }
                        if (value.param == 'horallegada') {
                            $('#recipient-horallegada').addClass('is-invalid');
                            $('#invalid-horallegada').text(value.msg);
                        }
                        if (value.param == 'asientosAsignados') {
                            $('#recipient-asientosAsignados').addClass('is-invalid');
                            $('#invalid-asientosAsignados').text(value.msg);
                        }
                        if (value.param == 'combi') {
                            $('#recipient-combi').addClass('is-invalid');
                            $('#invalid-combi').text(value.msg);
                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: value.msg
                            })
                        }
                        if (value.param == 'fechapublicacion') {
                            $('#recipient-fechapublicacion').addClass('is-invalid');
                            $('#invalid-fechapublicacion').text(value.msg);
                        }
                        if (value.param == 'precio') {
                            $('#recipient-precio').addClass('is-invalid');
                            $('#invalid-precio').text(value.msg);
                        }
                        if (value.param == "viaje") {
                            $('#recipient-combi').addClass('is-invalid');
                            $('#invalid-combi').text(value.msg);
                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: value.msg
                            })
                        }
                    });
                } else {
                    if (edit) {
                        $('#exampleModal').modal('toggle');
                        Swal.fire(
                            'Editado!',
                            'El viaje se ha editado exitosamente!',
                            'success'
                        )
                    } else {
                        Swal.fire(
                            'Agregado!',
                            'El viaje se ha agregado exitosamente!',
                            'success'
                        )
                    }
                    $.ajax({
                        type: 'GET',
                        url: 'http://localhost:3000/admin/viajesJSON',
                        data: {},
                        dataType: 'json',
                        success: function (data) {
                            $('#table').bootstrapTable('load', data);
                        }, error: function () {
                            alert('Error conexion con el servidor');
                        }
                    });
                    $("#recipient-ruta").removeClass("is-invalid is-valid");
                    $("#recipient-fechasalida").removeClass("is-invalid is-valid");
                    $("#recipient-horasalida").removeClass("is-invalid is-valid");
                    $("#recipient-fechallegada").removeClass("is-invalid is-valid");
                    $("#recipient-horallegada").removeClass("is-invalid is-valid");
                    $("#recipient-combi").removeClass("is-invalid is-valid");
                    $("#recipient-asientosAsignados").removeClass("is-invalid is-valid");
                    $("#recipient-fechapublicacion").removeClass("is-invalid is-valid");
                    $("#recipient-precio").removeClass("is-invalid is-valid");
                    $('#modalForm').trigger("reset");
                }
            }
        })
    });
    //---------------------------------------------------------------------------------------------------TERMINO EL BOTON SUBMIT-------------------------------------------------------------------------------------


    //---------------------------------------------------------------------------------------------------SWEET ALERT-------------------------------------------------------------------------------------
    function confirmar(id) {
        Swal.fire({
            title: 'Seguro que quieres eliminarlo?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Si, eliminarlo!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax('/admin/viajes/eliminar/', {
                    type: 'DELETE',
                    data: { id },
                    success: function (res) {
                        if (res.result) {
                            $.ajax({
                                type: 'GET',
                                url: 'http://localhost:3000/admin/viajesJSON',
                                data: {},
                                dataType: 'json',
                                success: function (data) {
                                    $('#table').bootstrapTable('load', data);
                                }, error: function () {
                                    alert('Error conexion con el servidor');
                                }
                            });
                            Swal.fire(
                                'Eliminado!',
                                res.message,
                                'success'
                            )
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: res.message
                            })
                        }
                    },
                    error: function (data) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Something went wrong!'
                        })
                    }
                });
            }
        })
    };

    function confirmarInsumo(id) {
        Swal.fire({
            title: 'Seguro que quieres eliminarlo?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Si, eliminarlo!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax('/admin/insumoViaje/eliminar', {
                    type: 'DELETE',
                    data: { id },
                    success: function (res) {
                        if (res.result) {
                            $.ajax({
                                type: 'GET',
                                url: 'http://localhost:3000/admin/insumosViajeJSON/'+res.value,
                                data: {},
                                dataType: 'json',
                                success: function (data) {
                                    $('#tableInsumos').bootstrapTable('load', data);
                                }, error: function () {
                                    alert('Error conexion con el servidor');
                                }
                            });
                            Swal.fire(
                                'Eliminado!',
                                res.message,
                                'success'
                            )
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: res.message
                            })
                        }
                    },
                    error: function (data) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Something went wrong!'
                        })
                    }
                });
            }
        })
    };
    //---------------------------------------------------------------------------------------------------TERMINO SWEET ALERT-------------------------------------------------------------------------------------

    function mostrarInsumos(id) {
        $('#id_insumoViaje').val(id);
        $('#insumosModal').modal('show')
        $(document).ready(function () {
            $('#tableInsumos').bootstrapTable('load', []);
            $.ajax({
                type: 'GET',
                url: 'http://localhost:3000/admin/insumosViajeJSON/' + id,
                data: {},
                dataType: 'json',
                success: function (data) {
                    $('#tableInsumos').bootstrapTable('load', data);
                }, error: function () {
                    alert('Error conexion con el servidor');
                }
            });
        });

    }
</script>