<div class="mx-3 container_tablas">
    <strong>
        <table class="table table-dark table-borderless" id="table" data-search="true" data-toggle="table"
            data-buttons="buttons" data-buttons-class="success" data-show-button-text="true" data-pagination="true"
            data-locale="es-AR">
            <thead>
                <tr class="">
                    <th data-field="ruta" data-sortable="true">
                        Ruta
                    </th>
                    <th data-field="fecha_salida" data-sortable="true">
                        Fecha de salida
                    </th>
                    <th data-field="hora_salida" data-sortable="true">
                        Hora de salida
                    </th>
                    <th data-field="fecha_llegada" data-sortable="true">
                        Fecha de llegada
                    </th>
                    <th data-field="hora_llegada" data-sortable="true">
                        Hora de llegada
                    </th>
                    <th data-field="estado" data-sortable="true">
                        Estado
                    </th>
                    <th data-field="id_viajechofer" data-formatter="LinkFormatterVenderPasaje"><i class="fas fa-cart-plus"></i></i>
                    <th data-field="id_viajechofer" data-formatter="LinkFormatterComenzar"></i>
                    </th>
                    <th data-field="id_usuarioviaje" data-formatter="LinkFormatterFinalizar"></i>
                    </th>
                    <th data-field="id_usuarioviaje" data-formatter="LinkFormatterCancelar"></i>
                    </th>
                    
                </tr>
            </thead>
        </table>
    </strong>
</div>

<script>
    $(document).ready(function () {
        $table = $('#table');
        $('#table').bootstrapTable('load', []);
        $.ajax({
            type: 'GET',
            url: 'http://localhost:3000/chofer/arealizarJSON',
            data: {},
            dataType: 'json',
            success: function (data) {
                $('#table').bootstrapTable('load', data);
            }, error: function () {
                alert('Error conexion con el servidor');
            }
        });
    });
    function LinkFormatterComenzar(value) {
        console.log("este es el value",value)
        return "<a onclick='comenzar(" + value + ")' ><button class='btn btn-success'>Comenzar</button></a> "; //se tiene q cambiar la ruta para comenzar viajes
    }

    function LinkFormatterFinalizar(value, row) {
        return "<a href='/user/detalles/" + value + "' ><button class='btn btn-primary'>Finalizar</button></a> ";//se tiene q cambiar la ruta para finalizar viajes
    }

    function LinkFormatterVenderPasaje(value, row) {
        return "<a href='/chofer/venta/" + value + "'><button class='btn btn-warning'>Vender pasaje</button></a> ";//se tiene q cambiar la ruta para vender pasajes
    }

    function LinkFormatterCancelar(value, row) {
        return "<a href='/user/insumos/" + value + "' ><button class='btn btn-danger'>Cancelar</button></a> ";//se tiene q cambiar la ruta para cancelar viaje
    }



    function comenzar(id) {
        console.log(id)
        Swal.fire({
            title: 'Seguro que quieres comenzar el viaje?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Si, comenzar!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax('/chofer/comenzar/', {
                    type: 'POST',
                    data: { id },
                    success: function (res) {
                        if (res.result) {
                            $.ajax({
                                type: 'GET',
                                url: 'http://localhost:3000/chofer/arealizarJSON',
                                data: {},
                                dataType: 'json',
                                success: function (data) {
                                    $('#table').bootstrapTable('load', data);
                                }, error: function () {
                                    alert('Error conexion con el servidor');
                                }
                            });
                            Swal.fire(
                                'Comienzo exitoso!',
                                res.message,
                                'success'
                            )
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'No se puede comenzar!',
                                text: res.message
                            })
                        }
                    },
                    error: function (data) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Something went wrong!'
                        })
                    }
                });
            }
        })
    };
</script>